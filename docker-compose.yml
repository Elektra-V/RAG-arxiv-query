services:
  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6334:6333"  # External port 6334 to avoid conflict with original project
    volumes:
      - qdrant_data:/qdrant/storage

  langchain:
    build:
      context: .
      dockerfile: docker/Dockerfile.langchain
    env_file:
      - .env
    environment:
      - QDRANT_URL=http://qdrant:6333
      - LANGCHAIN_HOST=0.0.0.0
      - LANGCHAIN_PORT=9010
    depends_on:
      - qdrant
    ports:
      - "9010:9010"  # Changed from 8009 to avoid conflicts

  llamaindex:
    build:
      context: .
      dockerfile: docker/Dockerfile.llamaindex
    env_file:
      - .env
    environment:
      - QDRANT_URL=http://qdrant:6333
      - LLAMAINDEX_HOST=0.0.0.0
      - LLAMAINDEX_PORT=9020
    depends_on:
      - qdrant
    ports:
      - "9020:9020"  # Changed from 8080 to avoid conflicts

  ingestion:
    build:
      context: .
      dockerfile: docker/Dockerfile.ingestion
    env_file:
      - .env
    environment:
      - QDRANT_URL=http://qdrant:6333
      - INGESTION_HOST=0.0.0.0
      - INGESTION_PORT=9030
    depends_on:
      - qdrant
    ports:
      - "9030:9030"  # Changed from 8010 to avoid conflicts
    command: ["uv", "run", "python", "-m", "rag_api.services.ingestion.app"]

volumes:
  qdrant_data:
